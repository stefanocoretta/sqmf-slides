---
title: "Statistics and Quantitative Methods (S1)"
subtitle: "Week 7"
author: "Dr Stefano Coretta"
institute: "University of Edinburgh"
date: "2022/09/01"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css:
      - xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
      beforeInit: "../../assets/macros.js"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, dpi = 300, out.height = "500px", fig.align = "center")
knitr::opts_knit$set(root.dir = here::here())
options(htmltools.dir.version = FALSE)
library(tidyverse)
theme_set(theme_light())
library(magrittr)
library(xaringanExtra)
use_xaringan_extra(c("panelset", "tachyons", "freezeframe"))
library(ggeffects)
library(marginaleffects)
options(show.signif.stars = FALSE)
library(broom.mixed)
library(sqmf)
data("shallow")
data("polite")
data("gestures")
data("dur_ita_pol")
dur_ita_pol %<>% drop_na(f1, v1_duration)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_light(
  base_color = "#23395b",
  text_font_google = google_font("Lato", "400", "700", "400i", "700i"),
  header_font_google = google_font("Montserrat", "400", "700", "400i", "700i"),
  code_font_google = google_font("Source Code Pro", "400", "700")
)
```

class: center middle inverse

# INTERACTIONS

---

layout: true

# Shallow morphological parsing

---

```{r shallow}
shallow %>% select(ID, Group, Target, Relation_type, Branching, accuracy)
```

---

```{r shallow-2}
shallow <- shallow %>%
  filter(Relation_type != "NonConstituent") %>%
  mutate(
    Group = factor(Group, levels = c("L1", "L2")),
    Relation_type = factor(Relation_type, levels = c("Unrelated", "Constituent", "NonConstituent")),
    Branching = factor(Branching, levels = c("Left", "Right")),
    accuracy = factor(accuracy, levels = c("incorrect", "correct"))
  )
```

---

```{r shallow-plot-2}
shallow %>%
  ggplot(aes(Relation_type, fill = accuracy)) +
  geom_bar(position = "fill") +
  facet_grid(~ Branching)
```

---

```{r shallow-lm}
shallow_lm <- glm(accuracy ~ Relation_type + Branching, data = shallow, family = binomial())
```

$$\text{accuracy}_{LO} = \beta_0 + \beta_1 \cdot \text{Relation_type}_{Const} + \beta_2 \cdot \text{Branching}_{Right}$$


<br>

--

$$\text{accuracy(Unrelated, Left)}_{LO} = \beta_0 + \beta_1 \cdot 0 + \beta_2 \cdot 0 = \beta_0$$

$$\text{accuracy(Constituent, Left)}_{LO} = \beta_0 + \beta_1 \cdot 1 + \beta_2 \cdot 0 = \beta_0 + \beta_1$$
$$\text{accuracy(Unrelated, Right)}_{LO} = \beta_0 + \beta_1 \cdot 0 + \beta_2 \cdot 1 = \beta_0 + \beta_2$$

$$\text{accuracy(Constituent, Right)}_{LO} = \beta_0 + \beta_1 \cdot 1 + \beta_2 \cdot 1 = \beta_0 + \beta_1 + \beta_2$$

---

```{r shallow-tidy}
# library(broom.mixed)
tidy(shallow_lm)
```

--

|                | Left          | Right                 |
|----------------|---------------|-----------------------|
| Unrelated      | 0.888         | 0.888 + 1.516         |
| Constituent    | 0.888 + 0.477 | 0.888 + 0.477 + 1.516 |

--

|                | Left  | Right |
|----------------|-------|-------|
| Unrelated      | 0.888 | 2.404 |
| Constituent    | 1.365 | 2.881 |

---

```{r shallow-preds}
ggpredict(shallow_lm, terms = c("Relation_type", "Branching"))
```

---

```{r shallow-preds-plot}
ggpredict(shallow_lm, terms = c("Branching", "Relation_type")) %>% plot()
```

---

```{r shallow-plot-2-2}
shallow %>%
  ggplot(aes(Relation_type, fill = accuracy)) +
  geom_bar(position = "fill") +
  facet_grid(~ Branching)
```




---

Let's add an interaction term between `Relation_type` and `Branching`.

```{r shallow-lm-2}
shallow_lm_2 <- glm(
  accuracy ~ Relation_type + Branching + Relation_type:Branching,
  data = shallow, family = binomial()
)
```

$$\text{accuracy}_{LO} = \beta_0 + \beta_1 \cdot \text{Relation_type}_{Const} + \beta_2 \cdot \text{Branching}_{Right} + \beta_3 \cdot \text{Relation_type}_{Const} \cdot \text{Branching}_{Right}$$


<br>

--

$$\text{accuracy(Unrelated, Left)}_{LO} = \beta_0 + \beta_1 \cdot 0 + \beta_2 \cdot 0 + \beta_3 \cdot 1 \cdot 0 = \beta_0$$

$$\text{accuracy(Constituent, Left)}_{LO} = \beta_0 + \beta_1 \cdot 1 + \beta_2 \cdot 0 + \beta_3 \cdot 1 \cdot 0 = \beta_0 + \beta_1$$
$$\text{accuracy(Unrelated, Right)}_{LO} = \beta_0 + \beta_1 \cdot 0 + \beta_2 \cdot 1 + \beta_3 \cdot 0 \cdot 1 = \beta_0 + \beta_2$$

$$\text{accuracy(Constituent, Right)}_{LO} = \beta_0 + \beta_1 \cdot 1 + \beta_2 \cdot 1 + \beta_3 \cdot 1 \cdot 1 = \beta_0 + \beta_1 + \beta_2 + \beta_3$$

---

```{r shallow-lm-2-2}
tidy(shallow_lm_2)
```

--

|             | Left          | Right                          |
|-------------|---------------|--------------------------------|
| Unrelated   | 0.822         | 0.822 + 1.775                  |
| Constituent | 0.822 + 0.628 | 0.822 + 0.628 + 1.775 + -0.588 |

--

|             | Left  | Right |
|-------------|-------|-------|
| Unrelated   | 0.822 | 2.597 |
| Constituent | 1.45  | 2.637 |

---

```{r shallow-preds-2}
ggpredict(shallow_lm_2, terms = c("Relation_type", "Branching"))
```

---

```{r shallow-preds-plot-2}
ggpredict(shallow_lm_2, terms = c("Branching", "Relation_type")) %>% plot()
```

---

Reporting of model

---

layout: false
layout: true

# Vowel duration and consonant voicing

---

Details of study

---

```{r vdur-voi-plot, warning=FALSE}
d_pos <- position_dodge(width = 0.8)

ggplot(dur_ita_pol, aes(c2_phonation, v1_duration)) +
  geom_jitter(size = 1, alpha = 0.25, width = 0.2) +
  geom_violin(aes(fill = c2_phonation), width = 0.25) +
  stat_summary(fun = mean, position = d_pos, colour = "black") +
  labs(
    x = "Consonant voicing", y = "Vowel duration"
  ) +
  theme(legend.position = "none")
```

---

```{r vdur-lang-plot}
ggplot(dur_ita_pol, aes(language, v1_duration)) +
  geom_jitter(size = 1, alpha = 0.25, width = 0.2) +
  geom_violin(aes(fill = language), width = 0.25) +
  stat_summary(fun = mean, position = d_pos, colour = "black") +
  labs(
    x = "Language", y = "Vowel duration"
  ) +
  theme(legend.position = "none")
```

---

```{r vdur-voi-lang-plot, warning=FALSE}
jd_pos <- position_jitterdodge(dodge.width = 0.8, jitter.width = 0.3)
d_pos <- position_dodge(width = 0.8)

ggplot(dur_ita_pol, aes(language, v1_duration)) +
  geom_jitter(aes(colour = c2_phonation), size = 1, alpha = 0.25, position = jd_pos) +
  geom_violin(aes(fill = c2_phonation), position = d_pos, width = 0.5) +
  stat_summary(aes(group = paste(c2_phonation, language)), fun = mean, position = d_pos, colour = "black") +
  labs(
    x = "Language", y = "Vowel duration"
  ) +
  theme(legend.position = "none")
```

???

Is the effect of consonant voicing on vowel duration the same in Italian and Polish?

To answer this question we need to include an interaction between consonant voicing and language.

---

```{r vdur-lm}
vdur_lm <- lm(v1_duration ~ c2_phonation * language, data = dur_ita_pol)
# NOTE: "c2_phonation * language" is a short-cut for
# "c2_phonation + language + c2_phonation:language"

tidy(vdur_lm)
```

---

```{r vdur-lm-pred}
ggpredict(vdur_lm, terms = c("c2_phonation", "language"))
```

---

```{r vdur-lm-pred-plot}
ggpredict(vdur_lm, terms = c("c2_phonation", "language")) %>%
  plot()
```

???


```{r}
marginaleffects(vdur_lm, variables = "c2_phonation", by = "language")
```


---

$$\text{v1_duration} = \beta_0 + \beta_1 \cdot \text{c2_phonation} + \beta_2 \cdot \text{language} + \beta_3 \cdot \text{c2_phonation} \cdot \text{language}$$

<br>

--

$$\text{v1_duration(voiced, Italian)} = \beta_0 + \beta_1 \cdot 0 + \beta_2 \cdot 0 + \beta_3 \cdot 0 \cdot 0= \beta_0$$

$$\text{v1_duration(voiceless, Italian)} = \beta_0 + \beta_1 \cdot 1 + \beta_2 \cdot 0 + \beta_3 \cdot 1 \cdot 0 = \beta_0 + \beta_1$$
$$\text{v1_duration(voiced, Polish)} = \beta_0 + \beta_1 \cdot 0 + \beta_2 \cdot 1 + \beta_3 \cdot 0 \cdot 1 = \beta_0 + \beta_2$$

$$\text{v1_duration(voiceless, Polish)} = \beta_0 + \beta_1 \cdot 1 + \beta_2 \cdot 1 + \beta_3 \cdot 1 \cdot 1 = \beta_0 + \beta_1 + \beta_2 + \beta_3$$

---

layout: false
class: center middle inverse

# CENTRING AND SCALING

---

layout: true

# Centring

---

```{r dur-ita}
dur_ita <- dur_ita_pol %>%
  filter(language == "Italian") %>%
  mutate(
    vowel = factor(vowel, levels = c("a", "o", "u"))
  )

dur_ita
```

---

```{r dur-ita-plot}
dur_ita %>%
  ggplot(aes(c2_duration, v1_duration)) +
  geom_point(alpha = 0.25) +
  geom_smooth(aes(colour = vowel), method = "lm")
```

???

There seems to be a positive effect of consonant duration on vowel duration: i.e. the longer the consonant the longer the vowel.

But is the effect of consonant duration on vowel duration the same for the three vowels /a, o, u/?

---

```{r vdur-lm-2}
vdur_lm_2 <- lm(v2_duration ~ c2_duration * vowel, data = dur_ita)

tidy(vdur_lm_2)
```

---

```{r vdur-lm-2-pred}
ggpredict(vdur_lm_2, terms = c("c2_duration [0, 50, 100]", "vowel"))
```

???

You can specify specific values for continuous predictors, like in `"c2_duration [0, 50, 100]"`.

Here, I am asking `ggpredict()` to return predicted values for when `c2_duration` is 0, 50 and 100 ms.

To learn more about how to specify values, check the documentation in `?ggpredict`.

---

```{r vdur-lm-2-pred-plot}
ggpredict(vdur_lm_2, terms = c("c2_duration", "vowel")) %>%
  plot()
```

???

Note that for plotting you should not give specific values for the continuous predictor that goes into the *x*-axis, because this axis will include the entire range of values for that continuous predictor.

---

- The estimated coefficients of the intercept and the effects of `vowel` are relative to when `c2_duration` is 0 ms.

- This is not very meaningful, because consonants cannot be 0 ms long (they would simply not be there!).

- We can get more meaningful coefficients by applying a type of transformation to `c2_duration` before we fit the model.

- This type of transformation is called **centring**.

---

**Centring simply consists of subtracting the mean of the variable from all the values.**

```{r dur-ita-cent}
dur_ita <- dur_ita %>%
  mutate(
    c2_duration_c = c2_duration - mean(c2_duration)
  )

dur_ita %>% select(vowel, v1_duration, c2_duration, c2_duration_c)
```

???

Since the mean of `c2_duration` in the data is `r mean(dur_ita$c2_duration)`, `c2_duration_c = 0` corresponds to `c2_duration = 90.33`.

The values of `c2_duration_c` are the difference between the value of `c2_duration` and the mean.

---

```{r c2-dur}
dur_ita %>%
  ggplot(aes(c2_duration)) + geom_density()
```

???

This is the density plot of `c2_duration`.

---

```{r c2-dur-c}
dur_ita %>%
  ggplot(aes(c2_duration_c)) + geom_density()
```

???

Here we plot `c2_duration_c`.

You can notice that the shape of the density is the same as before, but now the *x*-axis is different.

---

```{r vdur-lm-2-c}
vdur_lm_2_c <- lm(v2_duration ~ c2_duration_c * vowel, data = dur_ita)

tidy(vdur_lm_2_c)
```

???

Let's fit the model again, but now using `c2_duration_c`.

Now the estimates of the intercept and of vowel = /o/ and vowel = /u/ are interpreted as the estimates when `c2_duration_c` is 0, meaning when `c2_duration` is at its mean, i.e. `r mean(dur_ita$c2_duration)`.

---

```{r}
ggpredict(vdur_lm_2_c, terms = c("c2_duration_c", "vowel")) %>% plot()
```

???

The overall results are the same as in the model without centring.

What differs is just that the values of `c2_duration_c` now indicate the difference from the mean.


---

layout: false
layout: true

# Scaling (z-scores)


---

layout: false
class: center middle inverse

# SUM CODING


















---

# Exercise 1

```{r art-rate}
art_lm_1 <- lm(articulation_rate ~ attitude * musicstudent, data = polite)

summary(art_lm_1)
```

---

# Exercise 1

```{r art-rate-plot}
ggpredict(art_lm_1, terms = c("musicstudent", "attitude")) %>%
  plot() +
  theme(text = element_text(size = 20))
```

---

# Exercise 2

```{r f0}
f0_lm_1 <- lm(f0mn ~ attitude * months_ger, data = polite)

summary(f0_lm_1)
```

---

# Exercise 2

```{r f0-plot}
ggpredict(f0_lm_1, terms = c("attitude", "months_ger [1,12,24,48]")) %>%
  plot() +
  theme(text = element_text(size = 20))
```

---

# Exercise 3

```{r ct}
ct_lm_1 <- lm(ct ~ count * gesture * background, data = gestures)

summary(ct_lm_1)
```

---

# Exercise 3

```{r ct-plot}
ggpredict(ct_lm_1, terms = c("count", "gesture", "background")) %>%
  plot() +
  theme(text = element_text(size = 20))
```

---

# Do you notice something weird?

```{r ct-plot-2}
ggpredict(ct_lm_1, terms = c("count", "gesture", "background")) %>%
  plot() +
  theme(text = element_text(size = 20))
```

